<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Call of Duty TopUp - Dave TopUp</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  /* --- Basic styles (ke ou ka adapte) --- */
  body { font-family: Poppins, sans-serif; margin:0; background:#f6f9f8; color:#222; }
  header{ position:fixed; top:0; left:0; right:0; background:#fff; display:flex; align-items:center; justify-content:space-between; padding:10px 16px; box-shadow:0 1px 6px rgba(0,0,0,0.08); z-index:50; }
  header img{ height:40px; }
  .controls{ display:flex; gap:10px; align-items:center; }
  .btn { background:#2f855a; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
  .btn:hover{ background:#276749; }
  main{ padding:110px 18px 40px; max-width:980px; margin:0 auto; }
  h1,h2,h3{ margin:8px 0; }
  .hero { text-align:center; }
  .hero img{ max-width:360px; border-radius:8px; display:block; margin:14px auto; }
  .form-row{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:12px; }
  input[type=text], input[type=email], input[type=number], select { width:260px; padding:10px; border-radius:8px; border:1px solid #ddd; }
  .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(180px,1fr)); gap:14px; margin-top:18px; }
  .card { background:#fff; border-radius:10px; padding:12px; box-shadow:0 2px 8px rgba(0,0,0,0.06); position:relative; }
  .card img{ width:100%; height:110px; object-fit:cover; border-radius:8px; }
  .card h4{ margin:8px 0 4px; font-size:15px; }
  .card p{ margin:0; font-size:13px; color:#666; }
  .price { margin-top:8px; font-weight:700; color:#2f855a; }
  .price small{ color:#666; font-weight:400; }
  .info-icon{ position:absolute; top:10px; right:10px; color:#2f855a; cursor:pointer; }
  .connect-btns{ display:flex; gap:8px; justify-content:center; margin-top:8px; }
  .connect-btns button{ background:#fff; border:1px solid #ddd; padding:8px 10px; border-radius:8px; cursor:pointer; }
  .modal-back { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:120; }
  .modal { background:#fff; padding:18px; border-radius:10px; width:320px; max-width:92%; box-shadow:0 8px 30px rgba(0,0,0,0.2); }
  .close { float:right; cursor:pointer; color:#666; }
  .small-muted{ font-size:13px; color:#666; }
  .cart-count{ background:#e53e3e; color:#fff; padding:3px 7px; border-radius:20px; font-size:12px; margin-left:6px; }
  footer{ text-align:center; padding:16px; color:#666; }
  .price-display{ text-align:center; margin-top:8px; font-weight:700; color:#2f855a; }
  .social-links{ display:flex; gap:8px; justify-content:center; margin-top:8px; }
  .social-links a{ color:#2f855a; font-size:18px; }
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:12px">
    <a href="index.html"><img src="https://files.catbox.moe/iatbhv.png" alt="Dave TopUp"></a>
    <div class="small-muted">Call of Duty TopUp</div>
  </div>

  <div class="controls">
    <button id="openCartBtn" class="btn"><i class="fa-solid fa-cart-shopping"></i> Cart <span id="cartCount" class="cart-count" style="display:none">0</span></button>
    <button id="currencyToggle" class="btn">USD</button>
  </div>
</header>

<main>
  <section class="hero">
    <h1>Call of Duty — Achetez CP & Supply Pass</h1>
    <p class="small-muted">Choisissez pack CP oswa Supply Pass. Connectez-vous (Google/Facebook/Email) pou associer l'achat.</p>
    <img src="https://files.catbox.moe/46fnej.jpeg" alt="Call of Duty Banner">
  </section>

  <section style="margin-top:14px; text-align:center;">
    <!-- Connect (UI only, NO password stored) -->
    <div>
      <div class="connect-btns">
        <button class="connect-sim" data-method="google"><i class="fa-brands fa-google"></i> Google</button>
        <button class="connect-sim" data-method="facebook"><i class="fa-brands fa-facebook"></i> Facebook</button>
        <button class="connect-sim" data-method="email"><i class="fa-regular fa-envelope"></i> Email</button>
      </div>
      <div class="small-muted" style="margin-top:8px">NB: This is a UI-only connect. For real OAuth use server-side OAuth (I can help).</div>
    </div>

    <div class="form-row" style="margin-top:14px; justify-content:center;">
      <input id="emailConnected" type="email" placeholder="Aucun compte connecté" readonly style="width:320px; background:#fff;"/>
    </div>
  </section>

  <section style="margin-top:18px;">
    <h2>Choisissez un pack CP</h2>
    <div class="grid" id="cpGrid">
      <!-- Cards generated by JS -->
    </div>
    <div style="margin-top:14px; text-align:center;">
      <h3>Supply Pass</h3>
      <div class="grid" id="passGrid"></div>
    </div>
    <p class="price-display" id="selectedInfo">Sélection: —</p>
  </section>

  <section style="margin-top:20px;">
    <h3>Commande details</h3>
    <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;">
      <input id="playerEmail" type="email" placeholder="Email (pour la commande)" />
      <input id="playerUid" type="text" placeholder="UID du joueur (optionnel)" />
      <input id="playerName" type="text" placeholder="Pseudo (optionnel)" />
      <input id="qty" type="number" placeholder="Quantité (1)" value="1" style="width:120px" />
    </div>
    <div style="margin-top:12px; text-align:center;">
      <button id="addToCart" class="btn">Add to Cart</button>
      <button id="openCartHtml" class="btn" style="background:#1f6feb">Open Cart Page</button>
    </div>
  </section>

  <section style="margin-top:26px;">
    <h3>Produits similaires</h3>
    <div class="grid" id="similarGrid"></div>
  </section>

  <section style="margin-top:26px;">
    <h3>Owner info</h3>
    <div style="text-align:center;">
      <p class="small-muted">Géré par DaveTopUp — Contact: <a href="https://wa.me/50912345678" target="_blank">WhatsApp</a></p>
      <div class="social-links">
        <a href="#" target="_blank"><i class="fa-brands fa-facebook"></i></a>
        <a href="#" target="_blank"><i class="fa-brands fa-instagram"></i></a>
      </div>
    </div>
  </section>

</main>

<footer>© 2025 Dave TopUp — Call of Duty TopUp</footer>

<!-- Modal: connect / info / cart preview -->
<div id="modalWrap" class="modal-back">
  <div class="modal" id="modalContent">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <strong id="modalTitle">Titre</strong>
      <span class="close" id="modalClose">&times;</span>
    </div>
    <div id="modalBody" style="margin-top:10px"></div>
  </div>
</div>

<script>
/* ---------------------------
  CONFIG
  --------------------------- */
// Replace with your real API endpoints if you have one
const API = {
  // Example endpoints (replace with real)
  createOrder: "https://your-api.com/cod/createOrder",
  checkUser: "https://your-api.com/cod/checkUser"
};
const rate = 132; // HTG conversion
let isUSD = true;

/* ---------------------------
  DATA: CP packs & Passes
  --------------------------- */
const cpPacks = [
  { id:'cp_80', name:'80 CP', cp:80, price:0.99, img:'https://files.catbox.moe/cp_80.webp', desc:'Starter pack 80 CP' },
  { id:'cp_400', name:'400 CP', cp:400, price:4.49, img:'https://files.catbox.moe/cp_400.webp', desc:'Pack 400 CP' },
  { id:'cp_800', name:'800 CP', cp:800, price:8.99, img:'https://files.catbox.moe/cp_800.webp', desc:'Pack 800 CP' },
  { id:'cp_1600', name:'1600 CP', cp:1600, price:16.99, img:'https://files.catbox.moe/cp_1600.webp', desc:'Pack 1600 CP' },
  { id:'cp_3200', name:'3200 CP', cp:3200, price:32.99, img:'https://files.catbox.moe/cp_3200.webp', desc:'Pack 3200 CP' },
  { id:'cp_5400', name:'5400 CP', cp:5400, price:54.99, img:'https://files.catbox.moe/cp_5400.webp', desc:'Pack 5400 CP' },
  { id:'cp_10800', name:'10800 CP', cp:10800, price:99.99, img:'https://files.catbox.moe/cp_10800.webp', desc:'Mega pack 10800 CP' }
];

const passes = [
  { id:'pass_weekly', name:'Weekly Supply Pass', price:5.49, img:'https://files.catbox.moe/pass_weekly.webp', desc:'Weekly supply pass' },
  { id:'pass_monthly', name:'Monthly Supply Pass', price:14.99, img:'https://files.catbox.moe/pass_monthly.webp', desc:'Monthly supply pass' }
];

/* ---------------------------
  UTIL: modal
  --------------------------- */
const modalWrap = document.getElementById('modalWrap');
const modalTitle = document.getElementById('modalTitle');
const modalBody = document.getElementById('modalBody');
document.getElementById('modalClose').onclick = closeModal;
modalWrap.addEventListener('click', e => { if(e.target === modalWrap) closeModal(); });

function openModal(title, html){
  modalTitle.textContent = title;
  modalBody.innerHTML = html;
  modalWrap.style.display = 'flex';
}
function closeModal(){ modalWrap.style.display = 'none'; modalTitle.textContent=''; modalBody.innerHTML=''; }

/* ---------------------------
  RENDER CP packs & Passes
  --------------------------- */
const cpGrid = document.getElementById('cpGrid');
cpPacks.forEach(p=>{
  const d = document.createElement('div');
  d.className = 'card';
  d.innerHTML = `
    <img src="${p.img}" alt="${p.name}">
    <h4>${p.name}</h4>
    <p class="small-muted">${p.desc}</p>
    <div class="price">${formatPrice(p.price)} <small> / ${p.cp} CP</small></div>
    <i class="fa-solid fa-circle-info info-icon" title="Info"></i>
    <div style="margin-top:8px;text-align:center;">
      <button class="btn select-pack" data-id="${p.id}">Select</button>
    </div>
  `;
  d.querySelector('.info-icon').addEventListener('click', ()=> openModal(p.name, `<p>${p.desc}</p><p>Prix: ${formatPrice(p.price)}</p>`));
  cpGrid.appendChild(d);
});

const passGrid = document.getElementById('passGrid');
passes.forEach(p=>{
  const d = document.createElement('div');
  d.className = 'card';
  d.innerHTML = `
    <img src="${p.img}" alt="${p.name}">
    <h4>${p.name}</h4>
    <p class="small-muted">${p.desc}</p>
    <div class="price">${formatPrice(p.price)}</div>
    <div style="margin-top:8px;text-align:center;">
      <button class="btn select-pack" data-id="${p.id}">Select</button>
    </div>
  `;
  d.querySelector('.info-icon')?.addEventListener('click', ()=> openModal(p.name, `<p>${p.desc}</p><p>Prix: ${formatPrice(p.price)}</p>`));
  passGrid.appendChild(d);
});

/* ---------------------------
  Similar products
  --------------------------- */
const similarGrid = document.getElementById('similarGrid');
const similar = [
  {name:'Warzone Bundle', img:'https://files.catbox.moe/warzone.webp', desc:'Bundle spécial Warzone'},
  {name:'Diamond Weapon Skin', img:'https://files.catbox.moe/skin.webp', desc:'Skin limité'}
];
similar.forEach(s=>{
  const d = document.createElement('div'); d.className='card';
  d.innerHTML = `<img src="${s.img}" alt="${s.name}"><h4>${s.name}</h4><p class="small-muted">${s.desc}</p>
    <div style="margin-top:8px;text-align:center;"><button class="btn" onclick="openModal('${s.name}','${s.desc}')">Voir</button></div>`;
  similarGrid.appendChild(d);
});

/* ---------------------------
  Select pack logic + price display
  --------------------------- */
let selectedProduct = null;
document.body.addEventListener('click', (ev)=>{
  const sel = ev.target.closest('.select-pack');
  if(!sel) return;
  const id = sel.dataset.id;
  const prod = cpPacks.find(x=>x.id===id) || passes.find(x=>x.id===id);
  if(!prod) return;
  selectedProduct = prod;
  document.getElementById('selectedInfo').textContent = `Sélection: ${prod.name} — ${formatPrice(prod.price)} (${isUSD? formatPrice(prod.price) : convertHTG(prod.price)})`;
});

/* ---------------------------
  Connect (UI only)
  --------------------------- */
document.querySelectorAll('.connect-sim').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const method = btn.dataset.method; // google / facebook / email
    if(method === 'email'){
      openModal('Connect via Email', `<p>Entrez votre email pour associer l'achat:</p>
        <input id="connectEmail" type="email" placeholder="votre@email.com" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd" />
        <div style="margin-top:10px;text-align:right"><button id="doConnect" class="btn">Connect</button></div>
      `);
      setTimeout(()=>document.getElementById('doConnect').onclick = ()=>{
        const em = document.getElementById('connectEmail').value.trim();
        if(!em) return alert('Entrer email');
        // Save connected email locally (no password)
        localStorage.setItem('connectedEmail', em);
        document.getElementById('emailConnected').value = em;
        closeModal();
      },50);
    } else {
      // Simulate OAuth: only ask email (do NOT request password)
      openModal(`Connect via ${method}`, `<p>Simulate ${method} login — please enter email to continue (UI only).</p>
        <input id="oauthEmail" type="email" placeholder="votre@email.com" style="width:100%;padding:8px;border-radius:6px;border:1px solid #ddd" />
        <div style="margin-top:10px;text-align:right"><button id="doOauth" class="btn">Connect</button></div>`);
      setTimeout(()=>document.getElementById('doOauth').onclick = ()=>{
        const em = document.getElementById('oauthEmail').value.trim();
        if(!em) return alert('Entrer email');
        localStorage.setItem('connectedEmail', em);
        document.getElementById('emailConnected').value = em;
        closeModal();
      },50);
    }
  });
});

/* ---------------------------
  Add to Cart (localStorage)
  --------------------------- */
function formatPrice(v){ return `$${v.toFixed(2)}`; }
function convertHTG(v){ return `${Math.round(v * rate)} G`; }

document.getElementById('addToCart').addEventListener('click', ()=>{
  if(!selectedProduct) return alert('Choisissez un pack avant d’ajouter au panier.');
  const qty = Math.max(1, parseInt(document.getElementById('qty').value) || 1);
  const uid = document.getElementById('playerUid').value.trim();
  const name = document.getElementById('playerName').value.trim();
  const emailOrder = document.getElementById('playerEmail').value.trim() || localStorage.getItem('connectedEmail') || '';
  if(!emailOrder) return alert('Veuillez fournir un email de contact (ou connectez-vous).');

  const cart = JSON.parse(localStorage.getItem('cart_cod') || '[]');
  cart.push({
    id: selectedProduct.id || ('pass_'+Date.now()),
    name: selectedProduct.name,
    price: selectedProduct.price,
    qty,
    uid, namePlayer: name, email: emailOrder,
    meta: selectedProduct.cp ? `${selectedProduct.cp} CP` : selectedProduct.name
  });
  localStorage.setItem('cart_cod', JSON.stringify(cart));
  updateCartCount();
  alert('Produit ajouté au panier');
});

/* ---------------------------
  Cart preview / open Cart page
  --------------------------- */
function updateCartCount(){
  const cart = JSON.parse(localStorage.getItem('cart_cod') || '[]');
  const el = document.getElementById('cartCount');
  if(cart.length === 0) el.style.display='none';
  else { el.style.display='inline-block'; el.textContent = cart.length; }
}
document.getElementById('openCartBtn').addEventListener('click', ()=>{
  // open cart modal/HTML - we'll open a simple modal preview
  const cart = JSON.parse(localStorage.getItem('cart_cod') || '[]');
  if(cart.length===0){ openModal('Panier', '<p>Votre panier est vide</p>'); return; }
  let html = '<div style="max-height:300px;overflow:auto;">';
  cart.forEach((c,idx)=> {
    html += `<div style="padding:8px;border-bottom:1px solid #eee;">
      <strong>${c.name}</strong> x${c.qty} — ${formatPrice(c.price)} <br/>
      <small class="small-muted">${c.meta} — UID:${c.uid || '—' } — ${c.email}</small>
      <div style="margin-top:6px">
        <button onclick="removeCartItem(${idx})" class="btn" style="background:#e53e3e">Supprimer</button>
      </div>
    </div>`;
  });
  html += '</div><div style="margin-top:8px;text-align:right;"><button onclick="checkoutCart()" class="btn">Checkout</button></div>';
  openModal('Panier', html);
});
function removeCartItem(idx){
  const cart = JSON.parse(localStorage.getItem('cart_cod') || '[]');
  cart.splice(idx,1);
  localStorage.setItem('cart_cod', JSON.stringify(cart));
  updateCartCount();
  closeModal();
  // reopen to show update
  document.getElementById('openCartBtn').click();
}
document.getElementById('openCartHtml').addEventListener('click', ()=>{
  // open a dedicated cart page (simplified): we'll create/open cart.html
  window.open('cart.html','_blank');
});

/* ---------------------------
  Checkout (simulate API call)
  --------------------------- */
async function checkoutCart(){
  const cart = JSON.parse(localStorage.getItem('cart_cod') || '[]');
  if(cart.length===0) return alert('Panier vide');
  // prepare payload
  const payload = { items: cart, client: localStorage.getItem('connectedEmail') || cart[0].email, currency: isUSD ? 'USD' : 'HTG' };
  // Show loading
  openModal('Processing','<p>Envoi de la commande au serveur...</p>');
  try {
    // Replace with real POST to API.createOrder
    // const r = await fetch(API.createOrder, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
    // const res = await r.json();

    // Simulate success:
    await new Promise(r=>setTimeout(r,1000));
    // On success:
    closeModal();
    localStorage.removeItem('cart_cod');
    updateCartCount();
    alert('Commande envoyée (simulée). Voir confirmation par email.');
  } catch(err){
    console.error(err);
    closeModal();
    alert('Erreur lors du checkout');
  }
}

/* ---------------------------
  Comments & owner (basic)
  --------------------------- */
const ownerGrid = document.querySelector('.owner-info') || document.getElementById('ownerGrid');
document.getElementById('playerEmail').value = localStorage.getItem('connectedEmail') || '';
updateCartCount();

/* ---------------------------
  Currency toggle
  --------------------------- */
document.getElementById('currencyToggle').addEventListener('click', ()=>{
  isUSD = !isUSD;
  document.getElementById('currencyToggle').textContent = isUSD ? 'USD' : 'HTG';
  // update displayed prices:
  document.querySelectorAll('.price').forEach(el=>{
    const txt = el.textContent.trim();
    // attempt to find USD value in dataset - we render only USD initially so convert from stored numeric value not from text
    // For simplicity, find product by name:
    const cardName = el.closest('.card').querySelector('h4')?.textContent || '';
    const prod = cpPacks.find(p=>p.name===cardName) || passes.find(p=>p.name===cardName);
    if(prod){
      el.textContent = isUSD ? formatPrice(prod.price) : convertHTG(prod.price);
    }
  });
  // update selectedInfo
  if(selectedProduct) document.getElementById('selectedInfo').textContent = `Sélection: ${selectedProduct.name} — ${isUSD ? formatPrice(selectedProduct.price) : convertHTG(selectedProduct.price)}`;
});

/* ---------------------------
  INIT
  --------------------------- */
updateCartCount();

</script>
</body>
</html>